
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>wlcstat.chromo &#8212; wlcstat  documentation</title>
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">wlcstat  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">wlcstat.chromo</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for wlcstat.chromo</h1><div class="highlight"><pre>
<span></span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Kinked WLC with twist and fixed ends</span>

<span class="sd">This module calculates statistics for a series of worm-like chains with twist (DNA linkers) connected</span>
<span class="sd">by kinks imposed by nucleosomes. Calculations include R^2, Kuhn length, propogator matrices,</span>
<span class="sd">full Green&#39;s function for the end-to-end distance of the polymer, and looping statistics.</span>

<span class="sd">Code written by Bruno Beltran, Deepti Kannan, and Andy Spakowitz</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">jit</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">wlcstat.util</span> <span class="kn">import</span> <span class="n">wignerD</span> <span class="k">as</span> <span class="n">wd</span>

<span class="c1"># Constants for bare DNA properties</span>

<span class="n">naked_dna_length_per_base</span> <span class="o">=</span> <span class="mf">0.332</span>               <span class="c1"># length of DNA per base pair (nm)</span>
<span class="n">default_lt</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">/</span> <span class="n">naked_dna_length_per_base</span>    <span class="c1"># twist persistance length of DNA in bp: 100 nm, or ~301 bp</span>
<span class="n">default_lp</span> <span class="o">=</span> <span class="mi">50</span> <span class="o">/</span> <span class="n">naked_dna_length_per_base</span>     <span class="c1"># bend persistance length of DNA in bp: 50 nm, or ~150 bp</span>
<span class="n">default_w_in</span> <span class="o">=</span> <span class="mi">73</span>                               <span class="c1"># number of bound base pairs in the entry side of dyad axis base in bp</span>
<span class="n">default_w_out</span> <span class="o">=</span> <span class="mi">73</span>                              <span class="c1"># number of bound base pairs in the exit side of dyad axis base in bp</span>
<span class="n">default_Lw</span> <span class="o">=</span> <span class="n">default_w_in</span> <span class="o">+</span> <span class="n">default_w_out</span>

<span class="n">naked_dna_twist_density</span> <span class="o">=</span> <span class="mf">10.5</span>
<span class="n">naked_dna_length_per_base</span> <span class="o">=</span> <span class="mf">0.332</span>
<span class="n">naked_dna_thickness</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">nucleosome_bound_dna_twist_density</span> <span class="o">=</span> <span class="mf">10.17</span>

<span class="n">dna_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tau_n&#39;</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">nucleosome_bound_dna_twist_density</span><span class="p">,</span>
              <span class="s1">&#39;tau_d&#39;</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">naked_dna_twist_density</span><span class="p">,</span>
              <span class="s1">&#39;lpb&#39;</span><span class="p">:</span> <span class="n">naked_dna_length_per_base</span><span class="p">,</span>
              <span class="s1">&#39;r_dna&#39;</span><span class="p">:</span> <span class="n">naked_dna_thickness</span> <span class="o">/</span> <span class="mi">2</span><span class="p">}</span>

<span class="n">helix_params_reported_richmond_davey_2003</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="mf">1.67</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mf">133.6</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mf">41.181</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="mf">41.9</span><span class="p">,</span>
        <span class="s1">&#39;phi&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;psi0&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;x0&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;y0&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;z0&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

<span class="n">helix_params_best</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="mf">4.1899999999999995</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mf">4.531142964071856</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="mf">1.8375</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">147</span><span class="p">}</span>
<span class="c1">#helix_params_best = {&#39;r&#39;: 4.119206148106671, &#39;c&#39;: 5.1680650307039455, &#39;T&#39;: 1.9833333333333336, &#39;b&#39;: 147}</span>

<span class="c1"># Parameters for Fourier inversions</span>

<span class="n">Klin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">5</span><span class="p">,</span> <span class="mi">20000</span><span class="p">)</span>
<span class="n">Klog</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
<span class="n">Kvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">Klin</span><span class="p">,</span> <span class="n">Klog</span><span class="p">)))</span>
<span class="c1">#convert to little k -- units of inverse bp (this results in kmax = 332)</span>
<span class="n">kvals</span> <span class="o">=</span> <span class="n">Kvals</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">default_lp</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;Good values to use for integrating our Green&#39;s functions. If the lp of the</span>
<span class="sd">bare chain under consideration changes, these should change.&quot;&quot;&quot;</span>
<span class="n">TOL</span> <span class="o">=</span> <span class="mf">10e-14</span>


<div class="viewcode-block" id="r2_kinked_twlc"><a class="viewcode-back" href="../../chromo.html#wlcstat.chromo.r2_kinked_twlc">[docs]</a><span class="k">def</span> <span class="nf">r2_kinked_twlc</span><span class="p">(</span><span class="n">links</span><span class="p">,</span> <span class="n">lt</span><span class="o">=</span><span class="n">default_lt</span><span class="p">,</span> <span class="n">lp</span><span class="o">=</span><span class="n">default_lp</span><span class="p">,</span> <span class="n">kd_unwrap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">w_ins</span><span class="o">=</span><span class="n">default_w_in</span><span class="p">,</span>
                   <span class="n">w_outs</span><span class="o">=</span><span class="n">default_w_out</span><span class="p">,</span> <span class="n">tau_d</span><span class="o">=</span><span class="n">dna_params</span><span class="p">[</span><span class="s1">&#39;tau_d&#39;</span><span class="p">],</span> <span class="n">tau_n</span><span class="o">=</span><span class="n">dna_params</span><span class="p">[</span><span class="s1">&#39;tau_n&#39;</span><span class="p">],</span>
                   <span class="n">lmax</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">helix_params</span><span class="o">=</span><span class="n">helix_params_best</span><span class="p">,</span> <span class="n">unwraps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_phi</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the mean squared end-to-end distance, or :math:`\langle{R^2}\rangle` of a kinked WLC with a given set of</span>
<span class="sd">     linkers and unwrapping amounts.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    links : (L,) array-like</span>
<span class="sd">        linker length in bp</span>
<span class="sd">    w_ins : float or (L+1,) array_like</span>
<span class="sd">        amount of DNA wrapped on entry side of central dyad base in bp</span>
<span class="sd">    w_outs : float or (L+1,) array_like</span>
<span class="sd">        amount of DNA wrapped on exit side of central dyad base in bp</span>
<span class="sd">    tau_n : float</span>
<span class="sd">        twist density of nucleosome-bound DNA in rad/bp</span>
<span class="sd">    tau_d : float</span>
<span class="sd">        twist density of naked DNA in rad/bp</span>
<span class="sd">    lt : float</span>
<span class="sd">        twist persistence length in bp</span>
<span class="sd">    lp : float</span>
<span class="sd">        DNA persistence length in bp</span>
<span class="sd">    lmax : int</span>
<span class="sd">        maximum eigenvalue l for which to compute wigner D&#39; (default lmax = 2)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    r2 : (L,) array-like</span>
<span class="sd">        mean square end-to-end distance of kinked chain as a function of chain length in nm^2</span>
<span class="sd">    ldna : (L,) array-like</span>
<span class="sd">        mean square end-to-end distance of kinked chain as a function of chain length in nm</span>
<span class="sd">    kuhn : float</span>
<span class="sd">        Kuhn length as defined by :math:`\langle{R^2}\rangle / R_{max}` in long chain limit</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">helix_params</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
    <span class="n">num_linkers</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">links</span><span class="p">)</span>
    <span class="n">num_nucleosomes</span> <span class="o">=</span> <span class="n">num_linkers</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="c1"># resolve kd_unwrap</span>
    <span class="k">if</span> <span class="n">kd_unwrap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sites_unbound_left</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">binom</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">kd_unwrap</span><span class="p">)</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">num_nucleosomes</span><span class="p">)</span>
        <span class="n">sites_unbound_right</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">binom</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">kd_unwrap</span><span class="p">)</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">num_nucleosomes</span><span class="p">)</span>
        <span class="n">w_ins</span><span class="p">,</span> <span class="n">w_outs</span> <span class="o">=</span> <span class="n">resolve_wrapping_params</span><span class="p">(</span><span class="n">sites_unbound_left</span> <span class="o">+</span> <span class="n">sites_unbound_right</span><span class="p">,</span>
                <span class="n">w_ins</span><span class="p">,</span> <span class="n">w_outs</span><span class="p">,</span> <span class="n">num_nucleosomes</span><span class="p">,</span> <span class="n">unwrap_is</span><span class="o">=</span><span class="s1">&#39;sites&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">w_ins</span><span class="p">,</span> <span class="n">w_outs</span> <span class="o">=</span> <span class="n">resolve_wrapping_params</span><span class="p">(</span><span class="n">unwraps</span><span class="p">,</span> <span class="n">w_ins</span><span class="p">,</span> <span class="n">w_outs</span><span class="p">,</span> <span class="n">num_nucleosomes</span><span class="p">)</span>

    <span class="c1"># calculate unwrapping amounts based on w_ins and w_outs</span>
    <span class="n">mu_ins</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">w_ins</span>
    <span class="n">mu_outs</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">w_outs</span>
    <span class="c1"># only need one g matrix per linker length, no need to recalculate each time</span>
    <span class="c1"># perhaps we tabulate all g&#39;s and all M&#39;s and then mix and match to grow chain?</span>
    <span class="c1"># for now, build dictionary of (link, wrapping) -&gt; [B0, B1, B2]</span>
    <span class="n">bmats</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># B0-2curr will keep track of the B matrices as they propogate along the chain</span>
    <span class="c1"># initialize based on very first linker in chain</span>
    <span class="n">link</span> <span class="o">=</span> <span class="n">mu_outs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">links</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">mu_ins</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">wrap</span> <span class="o">=</span> <span class="n">w_outs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">w_ins</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">wrap</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">OmegaE2E</span><span class="p">(</span><span class="n">wrap</span><span class="p">,</span> <span class="n">tau_n</span><span class="o">=</span><span class="n">tau_n</span><span class="p">)</span>
    <span class="c1"># recall that our OmegaE2E matrix is designed to be applied from the right</span>
    <span class="c1"># so in order to add an arbitrary twist *before* the action of the</span>
    <span class="c1"># nucleosome (as if from changing the linker length) then we should apply</span>
    <span class="c1"># Rz to the left of R so that when the combined R is applied on the *right*</span>
    <span class="c1"># then the extra Rz is applied &quot;first&quot;.</span>
    <span class="c1"># in this code, we use &quot;(-gamma, -beta, -alpha)&quot; from the left as a proxy</span>
    <span class="c1"># from right multiplication in build_B_matrices_for_R2</span>
    <span class="k">if</span> <span class="n">random_phi</span><span class="p">:</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">Rz</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">())</span> <span class="o">@</span> <span class="n">R</span>
    <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="n">zyz_from_matrix</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
    <span class="n">bmats</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">build_B_matrices_for_R2</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">lt</span><span class="p">,</span> <span class="n">lp</span><span class="p">,</span> <span class="n">tau_d</span><span class="p">,</span> <span class="n">lmax</span><span class="p">)</span>
    <span class="n">B0curr</span><span class="p">,</span> <span class="n">B1curr</span><span class="p">,</span> <span class="n">B2curr</span> <span class="o">=</span> <span class="n">bmats</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="c1"># calculate R^2 as a function of number of nucleosomes (r2[0] is 0 nucleosomes)</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_linkers</span><span class="p">,))</span>
    <span class="n">lengthDNA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">r2</span><span class="p">)</span>
    <span class="n">r2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">B2curr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">B0curr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">lengthDNA</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">link</span>

    <span class="c1"># recursively calculate Nth propagator using B matrices</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_linkers</span><span class="p">):</span>
        <span class="c1"># add up the effective linker lengths including unwrapping</span>
        <span class="n">link</span> <span class="o">=</span> <span class="n">mu_outs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">links</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">mu_ins</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># w_ins[i+1] because the ith linker is between i, and i+1 nucs</span>
        <span class="n">wrap</span> <span class="o">=</span> <span class="n">w_outs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">w_ins</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">wrap</span><span class="p">)</span>
        <span class="c1"># update dictionary for this linker and wrapping amount, if necessary</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bmats</span><span class="p">:</span>
            <span class="n">R</span> <span class="o">=</span> <span class="n">OmegaE2E</span><span class="p">(</span><span class="n">wrap</span><span class="p">,</span> <span class="n">tau_n</span><span class="o">=</span><span class="n">tau_n</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">random_phi</span><span class="p">:</span>
                <span class="n">R</span> <span class="o">=</span> <span class="n">Rz</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">())</span> <span class="o">@</span> <span class="n">R</span>
            <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="n">zyz_from_matrix</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
            <span class="n">bmats</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">build_B_matrices_for_R2</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">lt</span><span class="p">,</span> <span class="n">lp</span><span class="p">,</span> <span class="n">tau_d</span><span class="p">,</span> <span class="n">lmax</span><span class="p">)</span>
        <span class="n">B0next</span><span class="p">,</span> <span class="n">B1next</span><span class="p">,</span> <span class="n">B2next</span> <span class="o">=</span> <span class="n">bmats</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="c1"># propogate B0curr, B1curr, B2curr matrices by a linker</span>
        <span class="n">B0temp</span> <span class="o">=</span> <span class="n">B0next</span><span class="nd">@B0curr</span>
        <span class="n">B1temp</span> <span class="o">=</span> <span class="n">B1next</span><span class="nd">@B0curr</span> <span class="o">+</span> <span class="n">B0next</span><span class="nd">@B1curr</span>
        <span class="n">B2temp</span> <span class="o">=</span> <span class="n">B2next</span><span class="nd">@B0curr</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">B1next</span><span class="nd">@B1curr</span> <span class="o">+</span> <span class="n">B0next</span><span class="nd">@B2curr</span>
        <span class="n">B0curr</span> <span class="o">=</span> <span class="n">B0temp</span>
        <span class="n">B1curr</span> <span class="o">=</span> <span class="n">B1temp</span>
        <span class="n">B2curr</span> <span class="o">=</span> <span class="n">B2temp</span>

        <span class="c1"># Rz^2 is B2[0,0], so multiply by 3 to get R^2</span>
        <span class="c1"># divide by B0[0,0] to ensure normalization is OK (shouldn&#39;t matter, since B0[0,0] is 1)</span>
        <span class="n">r2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">B2curr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">B0curr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">lengthDNA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lengthDNA</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">link</span>

    <span class="c1"># take absolute value of R2, convert to nm^2</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">r2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">dna_params</span><span class="p">[</span><span class="s1">&#39;lpb&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">lengthDNA</span> <span class="o">=</span> <span class="n">lengthDNA</span> <span class="o">*</span> <span class="n">dna_params</span><span class="p">[</span><span class="s1">&#39;lpb&#39;</span><span class="p">]</span>

    <span class="c1"># Find scaling of R2 with length of chain at larger length scales to calculate Kuhn length</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">min_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lengthDNA</span><span class="p">)</span><span class="o">*</span><span class="mi">5</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">kuhn</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">lengthDNA</span><span class="p">[</span><span class="n">min_i</span><span class="p">:],</span> <span class="n">r2</span><span class="p">[</span><span class="n">min_i</span><span class="p">:])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">kuhn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="k">return</span> <span class="n">r2</span><span class="p">,</span> <span class="n">lengthDNA</span><span class="p">,</span> <span class="n">kuhn</span><span class="p">,</span> <span class="n">w_ins</span><span class="p">,</span> <span class="n">w_outs</span></div>



<div class="viewcode-block" id="build_B_matrices_for_R2"><a class="viewcode-back" href="../../chromo.html#wlcstat.chromo.build_B_matrices_for_R2">[docs]</a><span class="k">def</span> <span class="nf">build_B_matrices_for_R2</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">lt</span><span class="o">=</span><span class="n">default_lt</span><span class="p">,</span> <span class="n">lp</span><span class="o">=</span><span class="n">default_lp</span><span class="p">,</span> <span class="n">tau_d</span><span class="o">=</span><span class="n">dna_params</span><span class="p">[</span><span class="s1">&#39;tau_d&#39;</span><span class="p">],</span> <span class="n">lmax</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Helper function to construct propogator B matrices for a single linker length link with kink</span>
<span class="sd">    rotation given by alpha, beta, gamma. Returns the following three matrices:</span>

<span class="sd">    .. math::</span>

<span class="sd">        B^{(n)} = \lim_{k \to 0}\frac{d^n B}{dk^n}</span>

<span class="sd">    for n = 0, 1, and 2. where B is defined as</span>

<span class="sd">    .. math::</span>

<span class="sd">        B^{l_f j_f}_{l_0 j_0} = \sqrt{\frac{8\pi^2}{2l_f+1}} {\mathcal{D}}^{j_f j_0}_{l_f}(-\gamma, -\beta, -\alpha) g^{j_0}_{l_f l_0}</span>
<span class="sd">        B^{(n)}[I_f, I_0] = M[I_f, I_0] * g^{(n)}[I_f, I_0]</span>

<span class="sd">    The g matrix is used for the linker propogator, and the M matrix represents the rotation due to the kink.</span>
<span class="sd">    All matrices are super-indexed by B[If, I0] where :math:`I(l, j) = l^2 + l + j`. :math:`I` can take on :math:`l^2+2l+1` possible values.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Andy adds 1 to the above formula for :math:`I` since his script is in Matlab, which is</span>
<span class="sd">    one-indexed.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    link : float</span>
<span class="sd">        linker length in bp</span>
<span class="sd">    lt : float</span>
<span class="sd">        twist persistence length in bp</span>
<span class="sd">    lp : float</span>
<span class="sd">        DNA persistence length in bp</span>
<span class="sd">    tau_d : float</span>
<span class="sd">        twist density of naked DNA in rad/bp</span>
<span class="sd">    lmax : int</span>
<span class="sd">        maximum eigenvalue l for which to compute wigner D&#39; (default lmax = 2)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    [B0, B1, B2] : (3,) list</span>
<span class="sd">        list of 3 matrices, each of dimension :math:`l_{max}^2 + 2l_{max} + 1`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># corresponds to If, I0 indices in Andy&#39;s notes: for every l, (2l+1) possible values of j</span>
    <span class="n">ntot</span> <span class="o">=</span> <span class="n">lmax</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">lmax</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="c1"># so matrix elements look like g[If,I0] where I0 = l0**2 + l0 + j0 and If = lf**2 + lf + jf</span>
    <span class="c1"># Note that for linker propogators (g matrices), jf always equals j0 (only perturbs l)</span>
    <span class="c1"># and for kink propogators (M matrices), lf always equals l0 (only perturbs j)</span>
    <span class="c1"># NOTE: for python, need to subtract 1 from Andy&#39;s formulas for indexing to work</span>

    <span class="c1"># g0 represents the 0th derivative of g with respect to k in the limit as k goes to 0</span>
    <span class="n">g0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ntot</span><span class="p">,</span> <span class="n">ntot</span><span class="p">),</span> <span class="s1">&#39;complex&#39;</span><span class="p">)</span>
    <span class="n">g1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">g0</span><span class="p">)</span>
    <span class="n">g2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">g0</span><span class="p">)</span>
    <span class="n">M</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">g0</span><span class="p">)</span>
    <span class="n">mywd</span> <span class="o">=</span> <span class="n">wd</span><span class="o">.</span><span class="n">wigner_d_vals</span><span class="p">()</span>

    <span class="c1"># define useful lambda functions of l and j used to compute eigenvalues, matrix elements</span>
    <span class="n">I</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">l</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">l</span> <span class="o">+</span> <span class="n">j</span> <span class="c1"># indexing</span>
    <span class="n">al</span>  <span class="o">=</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">l</span><span class="o">-</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="n">j</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">l</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="c1"># ladder coefficients alpha</span>
    <span class="n">lam</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="p">(</span><span class="n">l</span><span class="o">*</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">lp</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="n">lt</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">lp</span><span class="p">))</span><span class="o">*</span><span class="n">j</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">tau_d</span><span class="o">*</span><span class="n">j</span> <span class="c1"># eigenvalue of H0</span>

    <span class="c1"># build g and M matrices by looping over l0 and j0</span>
    <span class="k">for</span> <span class="n">l0</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lmax</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j0</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">l0</span><span class="p">,</span> <span class="n">l0</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="c1"># for this particular tuple (l0, j0), compute the relevant index in the g matrix:</span>
            <span class="n">I0</span> <span class="o">=</span> <span class="n">I</span><span class="p">(</span><span class="n">l0</span><span class="p">,</span> <span class="n">j0</span><span class="p">)</span>

            <span class="c1"># Compute relevant values of lambda_lj and alpha_lj to construct g0, g1, g2</span>
            <span class="n">laml0</span>   <span class="o">=</span> <span class="n">lam</span><span class="p">(</span><span class="n">l0</span><span class="p">,</span> <span class="n">j0</span><span class="p">)</span>
            <span class="n">laml0p1</span> <span class="o">=</span> <span class="n">lam</span><span class="p">(</span><span class="n">l0</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j0</span><span class="p">)</span>
            <span class="n">laml0m1</span> <span class="o">=</span> <span class="n">lam</span><span class="p">(</span><span class="n">l0</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j0</span><span class="p">)</span>
            <span class="n">laml0p2</span> <span class="o">=</span> <span class="n">lam</span><span class="p">(</span><span class="n">l0</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">j0</span><span class="p">)</span>
            <span class="n">laml0m2</span> <span class="o">=</span> <span class="n">lam</span><span class="p">(</span><span class="n">l0</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">j0</span><span class="p">)</span>
            <span class="n">all0</span>    <span class="o">=</span> <span class="n">al</span><span class="p">(</span><span class="n">l0</span><span class="p">,</span> <span class="n">j0</span><span class="p">)</span>
            <span class="n">all0p1</span>  <span class="o">=</span> <span class="n">al</span><span class="p">(</span><span class="n">l0</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j0</span><span class="p">)</span>
            <span class="c1"># NOTE: this will produce nans for (l0, j0) = (2, 2) and (2, -2), but</span>
            <span class="c1"># this quantity isn&#39;t used for those values of l0, j0 so no problem</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">l0</span> <span class="o">!=</span> <span class="mi">2</span> <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">j0</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">all0m1</span>  <span class="o">=</span> <span class="n">al</span><span class="p">(</span><span class="n">l0</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j0</span><span class="p">)</span>
            <span class="n">all0p2</span>  <span class="o">=</span> <span class="n">al</span><span class="p">(</span><span class="n">l0</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">j0</span><span class="p">)</span>

            <span class="c1">### Construct g0 matrix###</span>

            <span class="c1"># answer for g0 says l = l0 due to delta function, so g0 is diagonal</span>
            <span class="n">g0</span><span class="p">[</span><span class="n">I0</span><span class="p">,</span> <span class="n">I0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">laml0</span><span class="o">*</span><span class="n">link</span><span class="p">)</span>

            <span class="c1">#### Construct g1 matrix###</span>

            <span class="c1"># first consider case where l = l0-1</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">l0</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">If</span> <span class="o">=</span> <span class="n">I</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j0</span><span class="p">)</span>
            <span class="c1"># check out of bounds for l, ensure l does not exceed j0 (because j = j0)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">l</span> <span class="o">&lt;=</span> <span class="n">lmax</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">l</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">j0</span><span class="p">)):</span>
                <span class="n">g1</span><span class="p">[</span><span class="n">If</span><span class="p">,</span> <span class="n">I0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">all0</span><span class="o">/</span><span class="p">(</span><span class="n">laml0m1</span> <span class="o">-</span> <span class="n">laml0</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">laml0</span><span class="o">*</span><span class="n">link</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">laml0m1</span><span class="o">*</span><span class="n">link</span><span class="p">))</span>

            <span class="c1"># next consider the case where l = l0+1</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">l0</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">If</span> <span class="o">=</span> <span class="n">I</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j0</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">l</span> <span class="o">&lt;=</span> <span class="n">lmax</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">l</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">j0</span><span class="p">)):</span>
                <span class="n">g1</span><span class="p">[</span><span class="n">If</span><span class="p">,</span> <span class="n">I0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">all0p1</span><span class="o">/</span><span class="p">(</span><span class="n">laml0p1</span> <span class="o">-</span> <span class="n">laml0</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">laml0</span><span class="o">*</span><span class="n">link</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">laml0p1</span><span class="o">*</span><span class="n">link</span><span class="p">))</span>

            <span class="c1">#### Construct g2 matrix###</span>

            <span class="c1"># Case 1: l = l0 + 2</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">l0</span> <span class="o">+</span> <span class="mi">2</span>
            <span class="n">If</span> <span class="o">=</span> <span class="n">I</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j0</span><span class="p">)</span>
            <span class="c1"># only valid case is when (l0, j0) = (0, 0)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">l</span> <span class="o">&lt;=</span> <span class="n">lmax</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">l</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">j0</span><span class="p">)):</span>
                <span class="n">g2</span><span class="p">[</span><span class="n">If</span><span class="p">,</span> <span class="n">I0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">all0p1</span><span class="o">*</span><span class="n">all0p2</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">laml0</span><span class="o">*</span><span class="n">link</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="n">laml0p1</span> <span class="o">-</span> <span class="n">laml0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">laml0p2</span> <span class="o">-</span> <span class="n">laml0</span><span class="p">))</span> <span class="o">+</span>
                                              <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">laml0p1</span><span class="o">*</span><span class="n">link</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="n">laml0</span> <span class="o">-</span> <span class="n">laml0p1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">laml0p2</span> <span class="o">-</span> <span class="n">laml0p1</span><span class="p">))</span> <span class="o">+</span>
                                              <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">laml0p2</span><span class="o">*</span><span class="n">link</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="n">laml0</span> <span class="o">-</span> <span class="n">laml0p2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">laml0p1</span> <span class="o">-</span> <span class="n">laml0p2</span><span class="p">)))</span>

            <span class="c1"># Case 2: l = l0 --- diagonal entries of g2 matrix</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">l0</span>
            <span class="n">If</span> <span class="o">=</span> <span class="n">I</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j0</span><span class="p">)</span>
            <span class="c1"># Case 2A: terms with l0 + 1</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">l</span> <span class="o">&lt;=</span> <span class="n">lmax</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">l</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">j0</span><span class="p">)):</span>
                <span class="n">g2</span><span class="p">[</span><span class="n">If</span><span class="p">,</span> <span class="n">I0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">all0p1</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">link</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">laml0</span><span class="o">*</span><span class="n">link</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">laml0p1</span> <span class="o">-</span> <span class="n">laml0</span><span class="p">)</span> <span class="o">+</span>
                                          <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">laml0p1</span><span class="o">*</span><span class="n">link</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">laml0</span><span class="o">*</span><span class="n">link</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">laml0</span> <span class="o">-</span> <span class="n">laml0p1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="c1"># Case 2B: terms with l0 - 1</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">l</span> <span class="o">&lt;=</span> <span class="n">lmax</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">l</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">j0</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">g2</span><span class="p">[</span><span class="n">If</span><span class="p">,</span> <span class="n">I0</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">all0</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">link</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">laml0</span><span class="o">*</span><span class="n">link</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">laml0m1</span> <span class="o">-</span> <span class="n">laml0</span><span class="p">)</span> <span class="o">+</span>
                                          <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">laml0m1</span><span class="o">*</span><span class="n">link</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">laml0</span><span class="o">*</span><span class="n">link</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">laml0</span> <span class="o">-</span> <span class="n">laml0m1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

            <span class="c1"># Case 3: l = l0 - 2</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">l0</span> <span class="o">-</span> <span class="mi">2</span>
            <span class="n">If</span> <span class="o">=</span> <span class="n">I</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j0</span><span class="p">)</span>
            <span class="c1"># only valid case is when (l0, j0) = (2, 0)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">l</span> <span class="o">&lt;=</span> <span class="n">lmax</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">l</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">j0</span><span class="p">)):</span>
                <span class="n">g2</span><span class="p">[</span><span class="n">If</span><span class="p">,</span> <span class="n">I0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">all0</span><span class="o">*</span><span class="n">all0m1</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">laml0</span><span class="o">*</span><span class="n">link</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="n">laml0m1</span> <span class="o">-</span> <span class="n">laml0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">laml0m2</span> <span class="o">-</span> <span class="n">laml0</span><span class="p">))</span> <span class="o">+</span>
                                              <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">laml0m1</span><span class="o">*</span><span class="n">link</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="n">laml0</span> <span class="o">-</span> <span class="n">laml0m1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">laml0m2</span> <span class="o">-</span> <span class="n">laml0m1</span><span class="p">))</span> <span class="o">+</span>
                                              <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">laml0m2</span><span class="o">*</span><span class="n">link</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="n">laml0</span> <span class="o">-</span> <span class="n">laml0m2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">laml0m1</span> <span class="o">-</span> <span class="n">laml0m2</span><span class="p">)))</span>

            <span class="c1"># Next build M matrix</span>
            <span class="k">for</span> <span class="n">jf</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">l0</span><span class="p">,</span> <span class="n">l0</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">If</span> <span class="o">=</span> <span class="n">I</span><span class="p">(</span><span class="n">l0</span><span class="p">,</span> <span class="n">jf</span><span class="p">)</span>
                <span class="n">M</span><span class="p">[</span><span class="n">If</span><span class="p">,</span> <span class="n">I0</span><span class="p">]</span> <span class="o">=</span> <span class="n">mywd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">l0</span><span class="p">,</span> <span class="n">jf</span><span class="p">,</span> <span class="n">j0</span><span class="p">,</span> <span class="o">-</span><span class="n">gamma</span><span class="p">,</span> <span class="o">-</span><span class="n">beta</span><span class="p">,</span> <span class="o">-</span><span class="n">alpha</span><span class="p">)</span> <span class="o">/</span> <span class="n">mywd</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">l0</span><span class="p">,</span> <span class="n">jf</span><span class="p">,</span> <span class="n">j0</span><span class="p">)</span>

    <span class="n">B0</span> <span class="o">=</span> <span class="n">M</span><span class="nd">@g0</span>
    <span class="n">B1</span> <span class="o">=</span> <span class="n">M</span><span class="nd">@g1</span>
    <span class="n">B2</span> <span class="o">=</span> <span class="n">M</span><span class="nd">@g2</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">B0</span><span class="p">,</span> <span class="n">B1</span><span class="p">,</span> <span class="n">B2</span><span class="p">]</span></div>


<div class="viewcode-block" id="minimum_energy_no_sterics_linker_only"><a class="viewcode-back" href="../../chromo.html#wlcstat.chromo.minimum_energy_no_sterics_linker_only">[docs]</a><span class="k">def</span> <span class="nf">minimum_energy_no_sterics_linker_only</span><span class="p">(</span><span class="n">links</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">w_ins</span><span class="o">=</span><span class="n">default_w_in</span><span class="p">,</span>
        <span class="n">w_outs</span><span class="o">=</span><span class="n">default_w_out</span><span class="p">,</span> <span class="n">tau_n</span><span class="o">=</span><span class="n">dna_params</span><span class="p">[</span><span class="s1">&#39;tau_n&#39;</span><span class="p">],</span>
        <span class="n">tau_d</span><span class="o">=</span><span class="n">dna_params</span><span class="p">[</span><span class="s1">&#39;tau_d&#39;</span><span class="p">],</span> <span class="n">lpb</span><span class="o">=</span><span class="n">dna_params</span><span class="p">[</span><span class="s1">&#39;lpb&#39;</span><span class="p">],</span>
        <span class="n">helix_params</span><span class="o">=</span><span class="n">helix_params_best</span><span class="p">,</span> <span class="n">unwraps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_phi</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the theoretical conformation of a chain of nucleosomes</span>
<span class="sd">    connected by straight linkers (ground state) with no steric exclusion.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    links : (L,) array_like</span>
<span class="sd">        lengths of each linker segment</span>
<span class="sd">    tau_n : float</span>
<span class="sd">        twist density of nucleosome-bound DNA in rad/bp</span>
<span class="sd">    tau_d : float</span>
<span class="sd">        twist density of linker DNA in rad/bp</span>
<span class="sd">    w_ins : float or (L+1,) array_like</span>
<span class="sd">        amount of DNA wrapped on entry side of central dyad base</span>
<span class="sd">    w_outs : float or (L+1,) array_like</span>
<span class="sd">        amount of DNA wrapped on exit side of central dyad base</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    entry_rots : (L+1,3,3) np.ndarray</span>
<span class="sd">        the orientation of the material normals (as columns) of the DNA at the</span>
<span class="sd">        entry site</span>
<span class="sd">    entry_pos : (L+1,3) np.ndarray</span>
<span class="sd">        the position of the entry site of each nucleosome (where the first bp</span>
<span class="sd">        is bound)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">helix_params</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
    <span class="n">num_linkers</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">links</span><span class="p">)</span>
    <span class="n">num_nucleosomes</span> <span class="o">=</span> <span class="n">num_linkers</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">w_ins</span><span class="p">,</span> <span class="n">w_outs</span> <span class="o">=</span> <span class="n">resolve_wrapping_params</span><span class="p">(</span><span class="n">unwraps</span><span class="p">,</span> <span class="n">w_ins</span><span class="p">,</span> <span class="n">w_outs</span><span class="p">,</span> <span class="n">num_nucleosomes</span><span class="p">)</span>
    <span class="c1"># initialize to valid orientation matrix</span>
    <span class="n">entry_rots</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="n">num_nucleosomes</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="c1"># and to start at the origin</span>
    <span class="n">entry_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_nucleosomes</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_linkers</span><span class="p">):</span>
        <span class="c1"># w_ins[i+1] because the ith linker is between i, and i+1 nucs</span>
        <span class="n">Onext</span> <span class="o">=</span> <span class="n">OmegaNextEntry</span><span class="p">(</span><span class="n">links</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tau_n</span><span class="o">=</span><span class="n">tau_n</span><span class="p">,</span> <span class="n">tau_d</span><span class="o">=</span><span class="n">tau_d</span><span class="p">,</span>
                <span class="n">w_in</span><span class="o">=</span><span class="n">w_ins</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">w_out</span><span class="o">=</span><span class="n">w_outs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">helix_params</span><span class="o">=</span><span class="n">helix_params</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">random_phi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">Onext</span> <span class="o">=</span> <span class="n">Rz</span><span class="p">(</span><span class="n">random_phi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">())</span> <span class="o">@</span> <span class="n">Onext</span>
        <span class="n">entry_rots</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry_rots</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">@</span> <span class="n">Onext</span>
        <span class="n">exit_u</span> <span class="o">=</span> <span class="n">entry_rots</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,:,</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">exit_u</span> <span class="o">=</span> <span class="n">exit_u</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">exit_u</span><span class="p">)</span>
        <span class="n">mu_out</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">w_outs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">mu_in</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">w_ins</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1">#no translation included in this treatment for comparison to theory</span>
        <span class="n">entry_pos</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">exit_u</span><span class="o">*</span><span class="p">(</span><span class="n">mu_out</span> <span class="o">+</span> <span class="n">links</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">mu_in</span><span class="p">)</span><span class="o">*</span><span class="n">lpb</span>
    <span class="k">return</span> <span class="n">entry_rots</span><span class="p">,</span> <span class="n">entry_pos</span></div>


<div class="viewcode-block" id="resolve_wrapping_params"><a class="viewcode-back" href="../../chromo.html#wlcstat.chromo.resolve_wrapping_params">[docs]</a><span class="k">def</span> <span class="nf">resolve_wrapping_params</span><span class="p">(</span><span class="n">unwraps</span><span class="p">,</span> <span class="n">w_ins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">w_outs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unwrap_is</span><span class="o">=</span><span class="s1">&#39;bp&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Allow the user to specify either one value (and tile appropriately) or</span>
<span class="sd">    an array of values for the number of base pairs bound to the nucleosome.</span>
<span class="sd">    Also allow either the number of base pairs bound on each side of the dyad to be</span>
<span class="sd">    specified or the number of base pairs unwrapped relative to the crystal</span>
<span class="sd">    structure (in which case the unwrapping is split evenly on either side of</span>
<span class="sd">    the dyad for simplicity.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    unwraps : float or (N,) array_like</span>
<span class="sd">        total amount of unwrapped DNA on both sides</span>
<span class="sd">    w_ins (optional): float or (N,) array_like</span>
<span class="sd">        wrapped DNA on entry side of dyad axis</span>
<span class="sd">    w_outs (optional): float or (N,) array_like</span>
<span class="sd">        wrapped DNA on exit side of dyad axis</span>
<span class="sd">    N (optional): int</span>
<span class="sd">        output size, if other params are not array_like</span>
<span class="sd">    unwrap_is : string</span>
<span class="sd">        &#39;bp&#39; or &#39;sites&#39;, to specify whether we&#39;re counting the number of bp</span>
<span class="sd">        bound or the number of nucleosome-to-dna contacts (respectively)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    w_in : (N,) np.ndarray</span>
<span class="sd">        N output wrapping lengths on entry side of dyad axis</span>
<span class="sd">    w_out : (N,) np.ndarray</span>
<span class="sd">        N output wrapping lengths on exit side of dyad axis</span>

<span class="sd">    All functions take w_in, w_out directly now.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">w_ins</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">!=</span> <span class="p">(</span><span class="n">w_outs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either none or both of w_in and w_out must be specified.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">unwraps</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">unwraps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">unwraps</span><span class="p">)</span>
        <span class="n">w_ins</span><span class="p">,</span> <span class="n">w_outs</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">map</span><span class="p">(</span><span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">resolve_unwrap</span><span class="p">,</span> <span class="n">unwrap_is</span><span class="o">=</span><span class="n">unwrap_is</span><span class="p">),</span> <span class="n">unwraps</span><span class="p">))</span>
    <span class="n">w_ins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">w_ins</span><span class="p">)</span>
    <span class="n">w_outs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">w_outs</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">w_ins</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">N</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">w_ins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">w_ins</span><span class="p">,</span> <span class="p">(</span><span class="n">N</span><span class="p">,))</span>
        <span class="n">w_outs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">w_outs</span><span class="p">,</span> <span class="p">(</span><span class="n">N</span><span class="p">,))</span>
    <span class="k">return</span> <span class="n">w_ins</span><span class="p">,</span> <span class="n">w_outs</span></div>


<div class="viewcode-block" id="OmegaNextAssoc"><a class="viewcode-back" href="../../chromo.html#wlcstat.chromo.OmegaNextAssoc">[docs]</a><span class="k">def</span> <span class="nf">OmegaNextAssoc</span><span class="p">(</span><span class="n">Ll</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">w_in</span><span class="o">=</span><span class="n">default_w_in</span><span class="p">,</span> <span class="n">w_out</span><span class="o">=</span><span class="n">default_w_out</span><span class="p">,</span>
              <span class="n">tau_n</span><span class="o">=</span><span class="n">dna_params</span><span class="p">[</span><span class="s1">&#39;tau_n&#39;</span><span class="p">],</span> <span class="n">tau_d</span><span class="o">=</span><span class="n">dna_params</span><span class="p">[</span><span class="s1">&#39;tau_d&#39;</span><span class="p">],</span>
              <span class="n">helix_params</span><span class="o">=</span><span class="n">helix_params_best</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Nucleosome entry to exit (including unwrapped DNA on both sides).&quot;&quot;&quot;</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">helix_params</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
    <span class="n">mu_in</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">w_in</span>
    <span class="n">mu_out</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">w_out</span>
    <span class="k">return</span> <span class="n">Rz</span><span class="p">(</span><span class="n">mu_in</span><span class="o">*</span><span class="n">tau_d</span><span class="p">)</span> <span class="o">@</span> <span class="n">OmegaE2E</span><span class="p">(</span><span class="n">w_in</span> <span class="o">+</span> <span class="n">w_out</span><span class="p">,</span> <span class="n">tau_n</span><span class="o">=</span><span class="n">tau_n</span><span class="p">,</span>
            <span class="n">helix_params</span><span class="o">=</span><span class="n">helix_params</span><span class="p">)</span> <span class="o">@</span> <span class="n">Rz</span><span class="p">((</span><span class="n">Ll</span> <span class="o">+</span> <span class="n">mu_out</span><span class="p">)</span><span class="o">*</span><span class="n">tau_d</span><span class="p">)</span></div>

<div class="viewcode-block" id="OmegaNextExit"><a class="viewcode-back" href="../../chromo.html#wlcstat.chromo.OmegaNextExit">[docs]</a><span class="k">def</span> <span class="nf">OmegaNextExit</span><span class="p">(</span><span class="n">Ll</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">w_in</span><span class="o">=</span><span class="n">default_w_in</span><span class="p">,</span> <span class="n">w_out</span><span class="o">=</span><span class="n">default_w_out</span><span class="p">,</span>
        <span class="n">tau_n</span><span class="o">=</span><span class="n">dna_params</span><span class="p">[</span><span class="s1">&#39;tau_n&#39;</span><span class="p">],</span> <span class="n">tau_d</span><span class="o">=</span><span class="n">dna_params</span><span class="p">[</span><span class="s1">&#39;tau_d&#39;</span><span class="p">],</span>
        <span class="n">helix_params</span><span class="o">=</span><span class="n">helix_params_best</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Nucleosome exit to exit.&quot;&quot;&quot;</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">helix_params</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
    <span class="n">mu_in</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">w_in</span>
    <span class="n">mu_out</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">w_out</span>
    <span class="n">OE2E</span> <span class="o">=</span> <span class="n">OmegaE2E</span><span class="p">(</span><span class="n">w_in</span> <span class="o">+</span> <span class="n">w_out</span><span class="p">,</span> <span class="n">tau_n</span><span class="o">=</span><span class="n">tau_n</span><span class="p">,</span> <span class="n">helix_params</span><span class="o">=</span><span class="n">helix_params</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Rz</span><span class="p">((</span><span class="n">mu_out</span> <span class="o">+</span> <span class="n">Ll</span> <span class="o">+</span> <span class="n">mu_in</span><span class="p">)</span><span class="o">*</span><span class="n">tau_d</span><span class="p">)</span> <span class="o">@</span> <span class="n">OE2E</span></div>

<div class="viewcode-block" id="OmegaNextEntry"><a class="viewcode-back" href="../../chromo.html#wlcstat.chromo.OmegaNextEntry">[docs]</a><span class="k">def</span> <span class="nf">OmegaNextEntry</span><span class="p">(</span><span class="n">Ll</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">w_in</span><span class="o">=</span><span class="n">default_w_in</span><span class="p">,</span> <span class="n">w_out</span><span class="o">=</span><span class="n">default_w_out</span><span class="p">,</span>
        <span class="n">tau_n</span><span class="o">=</span><span class="n">dna_params</span><span class="p">[</span><span class="s1">&#39;tau_n&#39;</span><span class="p">],</span> <span class="n">tau_d</span><span class="o">=</span><span class="n">dna_params</span><span class="p">[</span><span class="s1">&#39;tau_d&#39;</span><span class="p">],</span>
        <span class="n">helix_params</span><span class="o">=</span><span class="n">helix_params_best</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Nucleosome entry to entry.&quot;&quot;&quot;</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">helix_params</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
    <span class="n">mu_in</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">w_in</span>
    <span class="n">mu_out</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">w_out</span>
    <span class="n">OE2E</span> <span class="o">=</span> <span class="n">OmegaE2E</span><span class="p">(</span><span class="n">w_in</span> <span class="o">+</span> <span class="n">w_out</span><span class="p">,</span> <span class="n">tau_n</span><span class="o">=</span><span class="n">tau_n</span><span class="p">,</span> <span class="n">helix_params</span><span class="o">=</span><span class="n">helix_params</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">OE2E</span> <span class="o">@</span> <span class="n">Rz</span><span class="p">((</span><span class="n">mu_out</span> <span class="o">+</span> <span class="n">Ll</span> <span class="o">+</span> <span class="n">mu_in</span><span class="p">)</span><span class="o">*</span><span class="n">tau_d</span><span class="p">)</span></div>


<div class="viewcode-block" id="OmegaE2E"><a class="viewcode-back" href="../../chromo.html#wlcstat.chromo.OmegaE2E">[docs]</a><span class="k">def</span> <span class="nf">OmegaE2E</span><span class="p">(</span><span class="n">Lw</span><span class="o">=</span><span class="n">default_Lw</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">tau_n</span><span class="o">=</span><span class="n">dna_params</span><span class="p">[</span><span class="s1">&#39;tau_n&#39;</span><span class="p">],</span> <span class="n">helix_params</span><span class="o">=</span><span class="n">helix_params_best</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Nucleosome core entry to exit rotation matrix</span>

<span class="sd">    :math:`\Omega_C \cdot R_z(L_w \left[ \tau_n - \tau_H \right])`</span>

<span class="sd">    Should be multiplied against entry orientation from the right to get the</span>
<span class="sd">    exit orientation.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    To get the exit orientation from the nucleosome assuming the bound DNA</span>
<span class="sd">    adopts a configuration with zero intrinsic twist is just</span>
<span class="sd">        &gt;&gt;&gt; import nuc_chain.geometry as ncg</span>
<span class="sd">        &gt;&gt;&gt; Omega0 = np.identity(3)</span>
<span class="sd">        &gt;&gt;&gt; Omega0Exit = Omega0 @ ncg.OmegaE2E(tau_n=0)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    tau_n : float</span>
<span class="sd">        the twist density of nucleosome-bound dna in radians/bp</span>
<span class="sd">    Lw : float</span>
<span class="sd">        Length of DNA bound to the nucleosome (#bound bp - 1)</span>
<span class="sd">    helix_params : Dict[str, float]</span>
<span class="sd">        parameters to :py:func:`H` family of function</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    OmegaE2E : (3,3) np.ndarray[float64]</span>
<span class="sd">        Entry to exit rotation matrix</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># N basepairs -&gt; N-1 inter-base-pair segments</span>
    <span class="c1"># in other words, no +1 since e.g. if w_in=w_out=1, then there are three</span>
    <span class="c1"># base pairs but the dna &quot;length&quot; is 2, not 3.</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">Lw</span> <span class="o">*</span> <span class="p">(</span><span class="n">tau_n</span> <span class="o">-</span> <span class="n">Htau</span><span class="p">(</span><span class="o">**</span><span class="n">helix_params</span><span class="p">))</span>
    <span class="n">Oc</span> <span class="o">=</span> <span class="n">OmegaC</span><span class="p">(</span><span class="n">Lw</span><span class="p">,</span> <span class="n">helix_params</span><span class="o">=</span><span class="n">helix_params</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Oc</span> <span class="o">@</span> <span class="n">Rz</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span></div>


<div class="viewcode-block" id="OmegaC"><a class="viewcode-back" href="../../chromo.html#wlcstat.chromo.OmegaC">[docs]</a><span class="k">def</span> <span class="nf">OmegaC</span><span class="p">(</span><span class="n">Lw</span><span class="p">,</span> <span class="n">helix_params</span><span class="o">=</span><span class="n">helix_params_best</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;inv(H_rot(0)) @ H_rot(Lw)</span>

<span class="sd">    The non-twist-corrected rotation matrix that takes the n, b, and u vectors</span>
<span class="sd">    of the helix from the start of the helix to the exit.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Lw : float</span>
<span class="sd">        Length of DNA bound to the nucleosome (#bound bp - 1)</span>
<span class="sd">    helix_params : (optional) Dict[str, float]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Omega_next : (3, 3) np.ndarray[float64]</span>
<span class="sd">        Rotation matrix taking the input to output orientations of the normal,</span>
<span class="sd">        binormal, tangent triad of the helix.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="c1"># since the helix has uniform torsion and curvature, this calculation is</span>
    <span class="c1"># invariant to translation of the parametric coordinate (could just as</span>
    <span class="c1"># easily use x, x + Lw for any x)</span>
    <span class="n">entry_inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">H_rot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">helix_params</span><span class="p">),</span> <span class="n">I</span><span class="p">)</span>
    <span class="n">exit_rotation</span> <span class="o">=</span> <span class="n">H_rot</span><span class="p">(</span><span class="n">Lw</span><span class="p">,</span> <span class="o">**</span><span class="n">helix_params</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">entry_inv</span><span class="nd">@exit_rotation</span></div>


<div class="viewcode-block" id="H"><a class="viewcode-back" href="../../chromo.html#wlcstat.chromo.H">[docs]</a><span class="k">def</span> <span class="nf">H</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parametric description of a simple left-handed helix aligned with</span>
<span class="sd">    :math:`\hat{z}`.</span>

<span class="sd">    The helix is parametrized on [0,1]. Has height c, radius r, and undergoes T</span>
<span class="sd">    twists in that range. Centerline is the positive z-axis and starting point</span>
<span class="sd">    is (r,0,0).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ${helix_doc}</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    X : (3,N) np.ndarray</span>
<span class="sd">        Position coordinate for each i.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">i</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">phase</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">i</span><span class="o">*</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="n">b</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="o">-</span><span class="n">phase</span><span class="p">),</span> <span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="o">-</span><span class="n">phase</span><span class="p">),</span> <span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">b</span><span class="p">)])</span></div>

<div class="viewcode-block" id="Hu"><a class="viewcode-back" href="../../chromo.html#wlcstat.chromo.Hu">[docs]</a><span class="k">def</span> <span class="nf">Hu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Tangent vector to :py:func:`H`, :math:`\frac{dH}{di}`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ${helix_doc}</span>
<span class="sd">    ${normed_doc}</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    U : (3,N) np.ndarray</span>
<span class="sd">        Tangent vector for each i.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">i</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">T</span><span class="o">/</span><span class="n">b</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="o">-</span><span class="n">p</span><span class="o">*</span><span class="n">i</span><span class="p">),</span>
                 <span class="o">-</span><span class="n">p</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="o">-</span><span class="n">p</span><span class="o">*</span><span class="n">i</span><span class="p">),</span>
                  <span class="n">c</span><span class="o">/</span><span class="n">b</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">i</span><span class="p">)])</span>
    <span class="k">if</span> <span class="n">normed</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">normalize_HX</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">U</span></div>

<div class="viewcode-block" id="Hn"><a class="viewcode-back" href="../../chromo.html#wlcstat.chromo.Hn">[docs]</a><span class="k">def</span> <span class="nf">Hn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Normal vector to :py:func:`H`. The unit vector in the direction of</span>
<span class="sd">    :math:`\frac{d^2 H}{di^2}`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ${helix_doc}</span>
<span class="sd">    ${normed_doc}</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    N : (3,N) np.ndarray</span>
<span class="sd">        Normal vector for each i.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">i</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">T</span><span class="o">/</span><span class="n">b</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">p</span><span class="o">*</span><span class="n">p</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="o">-</span><span class="n">p</span><span class="o">*</span><span class="n">i</span><span class="p">),</span>
                  <span class="o">-</span><span class="n">p</span><span class="o">*</span><span class="n">p</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="o">-</span><span class="n">p</span><span class="o">*</span><span class="n">i</span><span class="p">),</span>
                  <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">i</span><span class="p">)])</span>
    <span class="k">if</span> <span class="n">normed</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">normalize_HX</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">N</span></div>

<div class="viewcode-block" id="Hb"><a class="viewcode-back" href="../../chromo.html#wlcstat.chromo.Hb">[docs]</a><span class="k">def</span> <span class="nf">Hb</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Bi-normal vector to :py:func:`H`. Unit vector in the direction of</span>
<span class="sd">    :math:`\frac{dH}{di}\times\frac{d^2</span>
<span class="sd">    H}{di^2}`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ${helix_doc}</span>
<span class="sd">    ${normed_doc}</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    B : (3,N) np.ndarray</span>
<span class="sd">        Bi-normal vector for each i.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">Hu</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">Hn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;normed&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;normed&#39;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">normalize_HX</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">B</span></div>

<div class="viewcode-block" id="Hk"><a class="viewcode-back" href="../../chromo.html#wlcstat.chromo.Hk">[docs]</a><span class="k">def</span> <span class="nf">Hk</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Curvature of our standard helix.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ${helix_params_doc}</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    k : float64</span>
<span class="sd">        Curvature of the helix.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The curvature of a helix is a constant, in our parameterization it works</span>
<span class="sd">    out to :math:`\frac{r}{\gamma}\left(\frac{2\pi T}{b}\right)^2`, where</span>
<span class="sd">    :math:`\gamma = (1/b)\sqrt{4\pi^2r^2T^2 + c^2}`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">T</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">c2</span> <span class="o">=</span> <span class="n">c</span><span class="o">*</span><span class="n">c</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="n">r</span>
    <span class="k">return</span> <span class="n">r</span><span class="o">*</span><span class="n">psi</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">psi</span><span class="o">*</span><span class="n">r2</span> <span class="o">+</span> <span class="n">c2</span><span class="p">)</span><span class="o">/</span><span class="n">b</span></div>

<div class="viewcode-block" id="Htau"><a class="viewcode-back" href="../../chromo.html#wlcstat.chromo.Htau">[docs]</a><span class="k">def</span> <span class="nf">Htau</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Torsion of our standard helix.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ${helix_params_doc}</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tau : float64</span>
<span class="sd">        Torsion of the helix.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The torsion of a helix is a constant, in our parameterization it works out</span>
<span class="sd">    to :math:`\frac{-2\pi c T}{b} \left[4\pi^2r^2T^2 + c^2\right]^{-1/2}`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="n">T</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="n">T</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="n">b</span></div>

<div class="viewcode-block" id="H_rot"><a class="viewcode-back" href="../../chromo.html#wlcstat.chromo.H_rot">[docs]</a><span class="k">def</span> <span class="nf">H_rot</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;OmegaH(s). Given OmegaH(0) = [Hn, Hb, Hu].</span>

<span class="sd">    A rotation element, so det(H_rot) == 1.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">Hn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span>
            <span class="n">Hb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">Hu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">b</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="H_rot_oriented"><a class="viewcode-back" href="../../chromo.html#wlcstat.chromo.H_rot_oriented">[docs]</a><span class="k">def</span> <span class="nf">H_rot_oriented</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;OmegaH(s) given OmegaH(0) arbitrary.</span>

<span class="sd">    A rotation element, so det(H_rot) == 1.</span>
<span class="sd">    For some reason, tends to produce matrices that are numerically off of</span>
<span class="sd">    H_rot by a factor of like 1-2% in each element for equivalent parameters?</span>
<span class="sd">    Off by one somewhere? That&#39;s the order of magnitude of a bp.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">Hn_oriented</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="n">Hb_oriented</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span> <span class="n">Hu_oriented</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="H_oriented"><a class="viewcode-back" href="../../chromo.html#wlcstat.chromo.H_oriented">[docs]</a><span class="k">def</span> <span class="nf">H_oriented</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Position a helix at entry_pos and entry_rot, as returned by e.g.</span>
<span class="sd">    minimum_energy_no_sterics.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ${helix_doc}</span>
<span class="sd">    ${orientation_doc}</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    X : (3,N) np.ndarray</span>
<span class="sd">        Position coordinate for each i.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">HX_at_pos_rot_</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Hu_oriented"><a class="viewcode-back" href="../../chromo.html#wlcstat.chromo.Hu_oriented">[docs]</a><span class="k">def</span> <span class="nf">Hu_oriented</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Tangent to :py:func:`H_oriented` at entry_rot.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ${helix_params_doc}</span>
<span class="sd">    ${entry_rot_doc}</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    U : (3,N) np.ndarray</span>
<span class="sd">        Tangent vector for each i.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">HX_at_pos_rot_</span><span class="p">(</span><span class="n">Hu</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Hn_oriented"><a class="viewcode-back" href="../../chromo.html#wlcstat.chromo.Hn_oriented">[docs]</a><span class="k">def</span> <span class="nf">Hn_oriented</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Normal to :py:func:`H_oriented` at entry_rot.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ${helix_params_doc}</span>
<span class="sd">    ${entry_rot_doc}</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    n : (3,N) np.ndarray</span>
<span class="sd">        normal vector for each i.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">HX_at_pos_rot_</span><span class="p">(</span><span class="n">Hn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="normalize_HX"><a class="viewcode-back" href="../../chromo.html#wlcstat.chromo.normalize_HX">[docs]</a><span class="k">def</span> <span class="nf">normalize_HX</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Normalize a list of 3-vectors of shape (N,3).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    X : (N, 3) array_like</span>
<span class="sd">        N input vectors to be normalized.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    U : (N, 3) np.ndarray</span>
<span class="sd">        N outputs, such that np.linalg.norm(U[i,:]) == 1 for i in range N.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">X</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="kc">None</span><span class="p">,:]</span></div>


<div class="viewcode-block" id="Rx"><a class="viewcode-back" href="../../chromo.html#wlcstat.chromo.Rx">[docs]</a><span class="k">def</span> <span class="nf">Rx</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Rotation matrix about the x axis with angle theta.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    ..math::</span>

<span class="sd">        \frac{1}{\sqrt{3}}</span>
<span class="sd">        \begin{bmatrix}</span>
<span class="sd">            1 &amp;             0 &amp;              0\\</span>
<span class="sd">            0 &amp; np.cos(theta) &amp; -np.sin(theta)\\</span>
<span class="sd">            0 &amp; np.sin(theta) &amp;  np.cos(theta)</span>
<span class="sd">        \end{bmatrix}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span>             <span class="mi">0</span><span class="p">,</span>              <span class="mi">0</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)],</span>
                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span>  <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)]])</span></div>


<div class="viewcode-block" id="Ry"><a class="viewcode-back" href="../../chromo.html#wlcstat.chromo.Ry">[docs]</a><span class="k">def</span> <span class="nf">Ry</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Rotation matrix about the z axis with angle theta.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    ..math::</span>

<span class="sd">        \frac{1}{\sqrt{3}}</span>
<span class="sd">        \begin{bmatrix}</span>
<span class="sd">            np.cos(theta) &amp; 0 &amp; -np.sin(theta) \\</span>
<span class="sd">                        0 &amp; 1 &amp;              0 \\</span>
<span class="sd">            np.sin(theta) &amp; 0 &amp;  np.cos(theta)</span>
<span class="sd">        \end{bmatrix}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)],</span>
                     <span class="p">[</span>            <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>              <span class="mi">0</span><span class="p">],</span>
                     <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)]])</span></div>


<div class="viewcode-block" id="Rz"><a class="viewcode-back" href="../../chromo.html#wlcstat.chromo.Rz">[docs]</a><span class="k">def</span> <span class="nf">Rz</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Rotation matrix about the z axis with angle theta.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    ..math::</span>

<span class="sd">        \frac{1}{\sqrt{3}}</span>
<span class="sd">        \begin{bmatrix}</span>
<span class="sd">            np.cos(theta) &amp; -np.sin(theta) &amp; 0 \\</span>
<span class="sd">            np.sin(theta) &amp;  np.cos(theta) &amp; 0 \\</span>
<span class="sd">                        0 &amp;             0  &amp; 1</span>
<span class="sd">        \end{bmatrix}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span>  <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="p">[</span>            <span class="mi">0</span><span class="p">,</span>             <span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">]])</span></div>


<div class="viewcode-block" id="zyz_from_matrix"><a class="viewcode-back" href="../../chromo.html#wlcstat.chromo.zyz_from_matrix">[docs]</a><span class="k">def</span> <span class="nf">zyz_from_matrix</span><span class="p">(</span><span class="n">R</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert from a rotation matrix to (extrinsic zyz) Euler angles.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    R : (3, 3) array_like</span>
<span class="sd">        Rotation matrix to convert</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    alpha : float</span>
<span class="sd">        The final rotation about z&#39;&#39;</span>
<span class="sd">    beta : float</span>
<span class="sd">        The second rotation about y&#39;</span>
<span class="sd">    gamma : float</span>
<span class="sd">        the initial rotation about z</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    See pg. 13 of Bruno&#39;s (NCG) nucleosome geometry notes for a detailed</span>
<span class="sd">    derivation of this formula. Easy to test correctness by simply</span>
<span class="sd">    reversing the process R == Rz(alpha)@Ry(beta)@Rz(gamma).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]))</span> <span class="o">&lt;</span> <span class="n">TOL</span><span class="p">:</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">Rz_alpha</span> <span class="o">=</span> <span class="n">R</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="o">-</span><span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">beta</span><span class="p">),</span> <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span>
        <span class="n">Rz_alpha</span> <span class="o">=</span> <span class="n">R</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Rz</span><span class="p">(</span><span class="n">gamma</span><span class="p">))</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Ry</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">Rz_alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    <span class="c1"># # couldn&#39;t get this part of the formula to work for some reason</span>
    <span class="c1"># alpha = np.arctan2(R[0,2]/np.sin(beta), -R[1,2]/np.sin(beta))</span>
    <span class="k">return</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span></div>

<div class="viewcode-block" id="gen_chromo_conf"><a class="viewcode-back" href="../../chromo.html#wlcstat.chromo.gen_chromo_conf">[docs]</a><span class="k">def</span> <span class="nf">gen_chromo_conf</span><span class="p">(</span><span class="n">links</span><span class="p">,</span> <span class="n">lt</span><span class="o">=</span><span class="n">default_lt</span><span class="p">,</span> <span class="n">lp</span><span class="o">=</span><span class="n">default_lp</span><span class="p">,</span> <span class="n">kd_unwrap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">w_ins</span><span class="o">=</span><span class="n">default_w_in</span><span class="p">,</span>
             <span class="n">w_outs</span><span class="o">=</span><span class="n">default_w_out</span><span class="p">,</span> <span class="n">tau_d</span><span class="o">=</span><span class="n">dna_params</span><span class="p">[</span><span class="s1">&#39;tau_d&#39;</span><span class="p">],</span> <span class="n">tau_n</span><span class="o">=</span><span class="n">dna_params</span><span class="p">[</span><span class="s1">&#39;tau_n&#39;</span><span class="p">],</span>
             <span class="n">lpb</span><span class="o">=</span><span class="n">dna_params</span><span class="p">[</span><span class="s1">&#39;lpb&#39;</span><span class="p">],</span> <span class="n">r_dna</span><span class="o">=</span><span class="n">dna_params</span><span class="p">[</span><span class="s1">&#39;r_dna&#39;</span><span class="p">],</span>
             <span class="n">helix_params</span><span class="o">=</span><span class="n">helix_params_best</span><span class="p">,</span> <span class="n">unwraps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_phi</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate DNA and nucleosome conformation based on chain growth algorithm</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    links : (L,) array-like</span>
<span class="sd">        linker length in bp</span>
<span class="sd">    w_ins : float or (L+1,) array_like</span>
<span class="sd">        amount of DNA wrapped on entry side of central dyad base in bp</span>
<span class="sd">    w_outs : float or (L+1,) array_like</span>
<span class="sd">        amount of DNA wrapped on exit side of central dyad base in bp</span>
<span class="sd">    tau_n : float</span>
<span class="sd">        twist density of nucleosome-bound DNA in rad/bp</span>
<span class="sd">    tau_d : float</span>
<span class="sd">        twist density of naked DNA in rad/bp</span>
<span class="sd">    lt : float</span>
<span class="sd">        twist persistence length in bp</span>
<span class="sd">    lp : float</span>
<span class="sd">        DNA persistence length in bp</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    &quot;&quot;&quot;</span>


    <span class="c1"># Put the parameters into an appropriate form</span>
    <span class="n">nbpnuc</span> <span class="o">=</span> <span class="n">helix_params</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
    <span class="n">num_linkers</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">links</span><span class="p">)</span>
    <span class="n">num_nuc</span> <span class="o">=</span> <span class="n">num_linkers</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">hnuc</span> <span class="o">=</span> <span class="n">helix_params</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">rnuc</span> <span class="o">=</span> <span class="n">helix_params</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span>
    <span class="n">ltnuc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">hnuc</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">rnuc</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">eps</span> <span class="o">=</span> <span class="n">lp</span> <span class="o">/</span> <span class="n">lpb</span>
    <span class="n">epst</span> <span class="o">=</span> <span class="n">lt</span> <span class="o">/</span> <span class="n">lpb</span>
    <span class="n">om</span> <span class="o">=</span> <span class="n">tau_d</span>
    <span class="n">omnuc</span> <span class="o">=</span> <span class="n">tau_n</span>
    <span class="n">omdna</span> <span class="o">=</span> <span class="mf">0.75</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

    <span class="c1"># resolve kd_unwrap</span>
    <span class="k">if</span> <span class="n">kd_unwrap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sites_unbound_left</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">binom</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">kd_unwrap</span><span class="p">)</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">num_nuc</span><span class="p">)</span>
        <span class="n">sites_unbound_right</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">binom</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">kd_unwrap</span><span class="p">)</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">num_nuc</span><span class="p">)</span>
        <span class="n">w_ins</span><span class="p">,</span> <span class="n">w_outs</span> <span class="o">=</span> <span class="n">resolve_wrapping_params</span><span class="p">(</span><span class="n">sites_unbound_left</span> <span class="o">+</span> <span class="n">sites_unbound_right</span><span class="p">,</span>
                <span class="n">w_ins</span><span class="p">,</span> <span class="n">w_outs</span><span class="p">,</span> <span class="n">num_nucleosomes</span><span class="p">,</span> <span class="n">unwrap_is</span><span class="o">=</span><span class="s1">&#39;sites&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">w_ins</span><span class="p">,</span> <span class="n">w_outs</span> <span class="o">=</span> <span class="n">resolve_wrapping_params</span><span class="p">(</span><span class="n">unwraps</span><span class="p">,</span> <span class="n">w_ins</span><span class="p">,</span> <span class="n">w_outs</span><span class="p">,</span> <span class="n">num_nuc</span><span class="p">)</span>
    <span class="n">bounds</span> <span class="o">=</span> <span class="n">w_ins</span> <span class="o">+</span> <span class="n">w_outs</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="c1"># Initialize the conformation</span>
    <span class="n">num_bp_total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">links</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_bp_total</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">rdna1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_bp_total</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">rdna2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_bp_total</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_bp_total</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">t2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_bp_total</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">t3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_bp_total</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">rn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_nuc</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">un</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_nuc</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

    <span class="c1"># Generate the conformation using the chain-growth algorithm</span>
    <span class="n">t10</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">t30</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">t20</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">t30</span><span class="p">,</span> <span class="n">t10</span><span class="p">)</span>
    <span class="n">r0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">inuc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_nuc</span><span class="p">):</span>
        <span class="c1"># Generate the nucleosomal dna</span>
        <span class="n">bound</span> <span class="o">=</span> <span class="n">bounds</span><span class="p">[</span><span class="n">inuc</span><span class="p">]</span>
        <span class="n">n1</span> <span class="o">=</span> <span class="o">-</span><span class="n">t10</span>
        <span class="n">n3</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">rnuc</span> <span class="o">/</span> <span class="n">ltnuc</span><span class="p">)</span> <span class="o">*</span> <span class="n">t20</span> <span class="o">+</span> <span class="p">(</span><span class="n">hnuc</span> <span class="o">/</span> <span class="n">ltnuc</span><span class="p">)</span> <span class="o">*</span> <span class="n">t30</span>
        <span class="n">n2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">n3</span><span class="p">,</span> <span class="n">n1</span><span class="p">)</span>

        <span class="n">delta</span> <span class="o">=</span> <span class="o">-</span> <span class="n">rnuc</span> <span class="o">*</span> <span class="n">n1</span> <span class="o">+</span> <span class="p">(</span><span class="n">hnuc</span> <span class="o">*</span> <span class="p">(</span><span class="n">bound</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">lpb</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">ltnuc</span><span class="p">))</span> <span class="o">*</span> <span class="n">n3</span>
        <span class="n">rn</span><span class="p">[</span><span class="n">inuc</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">r0</span> <span class="o">+</span> <span class="n">delta</span>
        <span class="n">un</span><span class="p">[</span><span class="n">inuc</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">n3</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">bound</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">lpb</span>
            <span class="n">r</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">rnuc</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">s</span> <span class="o">/</span> <span class="n">ltnuc</span><span class="p">)</span> <span class="o">*</span> <span class="n">n1</span> <span class="o">+</span>
                           <span class="n">rnuc</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">s</span> <span class="o">/</span> <span class="n">ltnuc</span><span class="p">)</span> <span class="o">*</span> <span class="n">n2</span> <span class="o">+</span>
                           <span class="p">(</span><span class="n">hnuc</span> <span class="o">*</span> <span class="n">s</span> <span class="o">/</span> <span class="n">ltnuc</span><span class="p">)</span> <span class="o">*</span> <span class="n">n3</span> <span class="o">+</span> <span class="n">r0</span> <span class="o">-</span> <span class="n">rnuc</span> <span class="o">*</span> <span class="n">n1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">t1</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">t10</span>
                <span class="n">t2</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">t20</span>
                <span class="n">t3</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">t30</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">t3</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">rnuc</span> <span class="o">/</span> <span class="n">ltnuc</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">s</span> <span class="o">/</span> <span class="n">ltnuc</span><span class="p">)</span> <span class="o">*</span> <span class="n">n1</span>
                                <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">rnuc</span> <span class="o">/</span> <span class="n">ltnuc</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">s</span> <span class="o">/</span> <span class="n">ltnuc</span><span class="p">)</span> <span class="o">*</span> <span class="n">n2</span>
                                <span class="o">+</span> <span class="n">hnuc</span> <span class="o">/</span> <span class="n">ltnuc</span> <span class="o">*</span> <span class="n">n3</span><span class="p">)</span>
                <span class="n">t3</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:]</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">t3</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:])</span>
                <span class="n">th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">t3</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:],</span> <span class="n">t3</span><span class="p">[</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]))</span>
                <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">t3</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:],</span> <span class="n">t2</span><span class="p">[</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]),</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">t3</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:],</span> <span class="n">t1</span><span class="p">[</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]))</span>
                <span class="n">psi</span> <span class="o">=</span> <span class="o">-</span><span class="n">phi</span> <span class="o">+</span> <span class="n">omnuc</span>

                <span class="n">t1p</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">t1</span><span class="p">[</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
                       <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">t2</span><span class="p">[</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
                       <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">t3</span><span class="p">[</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>
                <span class="n">t1p</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">t3</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:],</span> <span class="n">t1p</span><span class="p">)</span> <span class="o">*</span> <span class="n">t3</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:]</span>
                <span class="n">t1p</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">t1p</span><span class="p">)</span>
                <span class="n">t2p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">t3</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:],</span> <span class="n">t1p</span><span class="p">)</span>
                <span class="n">t1</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span> <span class="o">*</span> <span class="n">t1p</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span> <span class="o">*</span> <span class="n">t2p</span>
                <span class="n">t2</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">t3</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:],</span> <span class="n">t1</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:])</span>

            <span class="n">rdna1</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">t1</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">r_dna</span>
            <span class="n">rdna2</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">r_dna</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">omdna</span><span class="p">)</span> <span class="o">*</span> <span class="n">t1</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span>
                                                     <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">omdna</span><span class="p">)</span> <span class="o">*</span> <span class="n">t2</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:])</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Calculate the position and orientation heading into the next linker</span>

        <span class="n">th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">eps</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sinh</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">eps</span><span class="p">)))</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">()</span>
        <span class="n">psi</span> <span class="o">=</span> <span class="o">-</span><span class="n">phi</span> <span class="o">+</span> <span class="n">om</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">()</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">epst</span><span class="p">)</span>

        <span class="n">t1p</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">t1</span><span class="p">[</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
               <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">t2</span><span class="p">[</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
               <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">t3</span><span class="p">[</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>
        <span class="n">t3p</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">t1</span><span class="p">[</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
               <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">t2</span><span class="p">[</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
               <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">t3</span><span class="p">[</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>
        <span class="n">t3p</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">t3p</span><span class="p">)</span>
        <span class="n">t1p</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">t3p</span><span class="p">,</span> <span class="n">t1p</span><span class="p">)</span> <span class="o">*</span> <span class="n">t3p</span>
        <span class="n">t1p</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">t1p</span><span class="p">)</span>
        <span class="n">t2p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">t3p</span><span class="p">,</span> <span class="n">t1p</span><span class="p">)</span>

        <span class="n">t10</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span> <span class="o">*</span> <span class="n">t1p</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span> <span class="o">*</span> <span class="n">t2p</span>
        <span class="n">t30</span> <span class="o">=</span> <span class="n">t3p</span>
        <span class="n">t20</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">t30</span><span class="p">,</span> <span class="n">t10</span><span class="p">)</span>
        <span class="n">r0</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">t30</span> <span class="o">*</span> <span class="n">lpb</span>

        <span class="c1"># Generate the linker dna</span>
        <span class="k">if</span> <span class="n">inuc</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">num_nuc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">link</span> <span class="o">=</span> <span class="n">links</span><span class="p">[</span><span class="n">inuc</span><span class="p">]</span>

            <span class="n">t1</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">t10</span>
            <span class="n">t2</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">t20</span>
            <span class="n">t3</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">t30</span>
            <span class="n">r</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">r0</span>
            <span class="n">rdna1</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">t1</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">r_dna</span>
            <span class="n">rdna2</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">r_dna</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">omdna</span><span class="p">)</span> <span class="o">*</span> <span class="n">t1</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span>
                                                     <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">omdna</span><span class="p">)</span> <span class="o">*</span> <span class="n">t2</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:])</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">link</span><span class="p">):</span>
                <span class="n">th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">eps</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sinh</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">eps</span><span class="p">)))</span>
                <span class="n">phi</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">()</span>
                <span class="n">psi</span> <span class="o">=</span> <span class="o">-</span><span class="n">phi</span> <span class="o">+</span> <span class="n">om</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">()</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">epst</span><span class="p">)</span>

                <span class="n">t1p</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">t1</span><span class="p">[</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
                       <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">t2</span><span class="p">[</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
                       <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">t3</span><span class="p">[</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>
                <span class="n">t3p</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">t1</span><span class="p">[</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
                       <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">t2</span><span class="p">[</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
                       <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">t3</span><span class="p">[</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>
                <span class="n">t3p</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">t3p</span><span class="p">)</span>
                <span class="n">t1p</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">t3p</span><span class="p">,</span> <span class="n">t1p</span><span class="p">)</span> <span class="o">*</span> <span class="n">t3p</span>
                <span class="n">t1p</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">t1p</span><span class="p">)</span>
                <span class="n">t2p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">t3p</span><span class="p">,</span> <span class="n">t1p</span><span class="p">)</span>

                <span class="n">t1</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span> <span class="o">*</span> <span class="n">t1p</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span> <span class="o">*</span> <span class="n">t2p</span>
                <span class="n">t3</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">t3p</span>
                <span class="n">t2</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">t3</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:],</span> <span class="n">t1</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:])</span>

                <span class="n">r</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">t3</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">lpb</span>
                <span class="n">rdna1</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">t1</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">r_dna</span>
                <span class="n">rdna2</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">r_dna</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">omdna</span><span class="p">)</span> <span class="o">*</span> <span class="n">t1</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span>
                                                     <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">omdna</span><span class="p">)</span> <span class="o">*</span> <span class="n">t2</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="p">:])</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Calculate the position and orientation heading into the nucleosome</span>
            <span class="n">th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">eps</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sinh</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">eps</span><span class="p">)))</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">()</span>
            <span class="n">psi</span> <span class="o">=</span> <span class="o">-</span><span class="n">phi</span> <span class="o">+</span> <span class="n">om</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">()</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">epst</span><span class="p">)</span>

            <span class="n">t1p</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">t1</span><span class="p">[</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
                   <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">t2</span><span class="p">[</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
                   <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">t3</span><span class="p">[</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>
            <span class="n">t3p</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">t1</span><span class="p">[</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
                   <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">t2</span><span class="p">[</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
                   <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">t3</span><span class="p">[</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>
            <span class="n">t3p</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">t3p</span><span class="p">)</span>
            <span class="n">t1p</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">t3p</span><span class="p">,</span> <span class="n">t1p</span><span class="p">)</span> <span class="o">*</span> <span class="n">t3p</span>
            <span class="n">t1p</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">t1p</span><span class="p">)</span>
            <span class="n">t2p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">t3p</span><span class="p">,</span> <span class="n">t1p</span><span class="p">)</span>

            <span class="n">t10</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span> <span class="o">*</span> <span class="n">t1p</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span> <span class="o">*</span> <span class="n">t2p</span>
            <span class="n">t30</span> <span class="o">=</span> <span class="n">t3p</span>
            <span class="n">t20</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">t30</span><span class="p">,</span> <span class="n">t10</span><span class="p">)</span>

            <span class="n">r0</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">t30</span> <span class="o">*</span> <span class="n">lpb</span>

    <span class="k">return</span> <span class="n">r</span><span class="p">,</span> <span class="n">rdna1</span><span class="p">,</span> <span class="n">rdna2</span><span class="p">,</span> <span class="n">rn</span><span class="p">,</span> <span class="n">un</span></div>


<div class="viewcode-block" id="gen_chromo_pymol_file"><a class="viewcode-back" href="../../chromo.html#wlcstat.chromo.gen_chromo_pymol_file">[docs]</a><span class="k">def</span> <span class="nf">gen_chromo_pymol_file</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">rdna1</span><span class="p">,</span> <span class="n">rdna2</span><span class="p">,</span> <span class="n">rn</span><span class="p">,</span> <span class="n">un</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;r_poly.pdb&#39;</span><span class="p">,</span> <span class="n">ring</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    r</span>
<span class="sd">    rdna1</span>
<span class="sd">    rdna2</span>
<span class="sd">    rn</span>
<span class="sd">    un</span>
<span class="sd">    filename</span>
<span class="sd">    ring</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Setup the parameters for imaging nucleosome array</span>
    <span class="n">hnuc</span> <span class="o">=</span> <span class="mf">2.265571482035928</span>

    <span class="c1"># Open the file</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>

    <span class="n">atomname1</span> <span class="o">=</span> <span class="s2">&quot;A1&quot;</span>    <span class="c1"># Chain atom type</span>
    <span class="n">atomname2</span> <span class="o">=</span> <span class="s2">&quot;A2&quot;</span>    <span class="c1"># Chain atom type</span>
    <span class="n">atomname3</span> <span class="o">=</span> <span class="s2">&quot;A3&quot;</span>    <span class="c1"># Chain atom type</span>
    <span class="n">atomname4</span> <span class="o">=</span> <span class="s2">&quot;A4&quot;</span>    <span class="c1"># Chain atom type</span>
    <span class="n">resname</span> <span class="o">=</span> <span class="s2">&quot;SSN&quot;</span>     <span class="c1"># Type of residue (UNKnown/Single Stranded Nucleotide)</span>
    <span class="n">chain</span> <span class="o">=</span> <span class="s2">&quot;A&quot;</span>         <span class="c1"># Chain identifier</span>
    <span class="n">resnum</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">numdna</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">numnuc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rn</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">descrip</span> <span class="o">=</span> <span class="s2">&quot;Pseudo atom representation of DNA&quot;</span>
    <span class="n">chemicalname</span> <span class="o">=</span> <span class="s2">&quot;Body and ribbon spatial coordinates&quot;</span>

    <span class="c1"># Write the preamble to the pymol file</span>

    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;HET    </span><span class="si">%3s</span><span class="s1">  </span><span class="si">%1s%4d</span><span class="s1">   </span><span class="si">%5d</span><span class="s1">     </span><span class="si">%-38s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">resname</span><span class="p">,</span> <span class="n">chain</span><span class="p">,</span> <span class="n">resnum</span><span class="p">,</span> <span class="n">numdna</span><span class="p">,</span> <span class="n">descrip</span><span class="p">))</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;HETNAM     </span><span class="si">%3s</span><span class="s1"> </span><span class="si">%-50s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">resname</span><span class="p">,</span> <span class="n">chemicalname</span><span class="p">))</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;FORMUL  1   </span><span class="si">%3s</span><span class="s1">    C20 N20 P21</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">resname</span><span class="p">))</span>

    <span class="c1"># Write the conformation to the pymol file</span>

    <span class="c1"># Define the dna centerline positions</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numdna</span><span class="p">):</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;ATOM</span><span class="si">%7d</span><span class="s1"> </span><span class="si">%4s</span><span class="s1"> </span><span class="si">%3s</span><span class="s1"> </span><span class="si">%1s</span><span class="s1">        </span><span class="si">%8.3f%8.3f%8.3f%6.2f%6.2f</span><span class="s1">           C</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                    <span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">atomname1</span><span class="p">,</span> <span class="n">resname</span><span class="p">,</span> <span class="n">chain</span><span class="p">,</span> <span class="n">r</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="mf">1.00</span><span class="p">,</span> <span class="mf">1.00</span><span class="p">))</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Define the dna strand 1 positions</span>
    <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numdna</span><span class="p">):</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;ATOM</span><span class="si">%7d</span><span class="s1"> </span><span class="si">%4s</span><span class="s1"> </span><span class="si">%3s</span><span class="s1"> </span><span class="si">%1s</span><span class="s1">        </span><span class="si">%8.3f%8.3f%8.3f%6.2f%6.2f</span><span class="s1">           C</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                    <span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">atomname2</span><span class="p">,</span> <span class="n">resname</span><span class="p">,</span> <span class="n">chain</span><span class="p">,</span> <span class="n">rdna1</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">rdna1</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">rdna1</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="mf">1.00</span><span class="p">,</span> <span class="mf">1.00</span><span class="p">))</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Define the dna strand 2 positions</span>
    <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numdna</span><span class="p">):</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;ATOM</span><span class="si">%7d</span><span class="s1"> </span><span class="si">%4s</span><span class="s1"> </span><span class="si">%3s</span><span class="s1"> </span><span class="si">%1s</span><span class="s1">        </span><span class="si">%8.3f%8.3f%8.3f%6.2f%6.2f</span><span class="s1">           C</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                    <span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">atomname3</span><span class="p">,</span> <span class="n">resname</span><span class="p">,</span> <span class="n">chain</span><span class="p">,</span> <span class="n">rdna2</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">rdna2</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">rdna2</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="mf">1.00</span><span class="p">,</span> <span class="mf">1.00</span><span class="p">))</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Define the nucleosome positions</span>
    <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numnuc</span><span class="p">):</span>
        <span class="n">rnucind</span> <span class="o">=</span> <span class="n">rn</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">hnuc</span> <span class="o">*</span><span class="n">un</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;ATOM</span><span class="si">%7d</span><span class="s1"> </span><span class="si">%4s</span><span class="s1"> </span><span class="si">%3s</span><span class="s1"> </span><span class="si">%1s</span><span class="s1">        </span><span class="si">%8.3f%8.3f%8.3f%6.2f%6.2f</span><span class="s1">           C</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                    <span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">atomname4</span><span class="p">,</span> <span class="n">resname</span><span class="p">,</span> <span class="n">chain</span><span class="p">,</span> <span class="n">rnucind</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rnucind</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rnucind</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mf">1.00</span><span class="p">,</span> <span class="mf">1.00</span><span class="p">))</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">rnucind</span> <span class="o">=</span> <span class="n">rn</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">hnuc</span> <span class="o">*</span><span class="n">un</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;ATOM</span><span class="si">%7d</span><span class="s1"> </span><span class="si">%4s</span><span class="s1"> </span><span class="si">%3s</span><span class="s1"> </span><span class="si">%1s</span><span class="s1">        </span><span class="si">%8.3f%8.3f%8.3f%6.2f%6.2f</span><span class="s1">           C</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                    <span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">atomname4</span><span class="p">,</span> <span class="n">resname</span><span class="p">,</span> <span class="n">chain</span><span class="p">,</span> <span class="n">rnucind</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rnucind</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rnucind</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mf">1.00</span><span class="p">,</span> <span class="mf">1.00</span><span class="p">))</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>



    <span class="c1"># Define the connectivity in the chain</span>

    <span class="c1"># Connectivity for the center beads</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">ring</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CONECT</span><span class="si">%5d%5d%5d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">count</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">numdna</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CONECT</span><span class="si">%5d%5d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">numdna</span><span class="p">):</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CONECT</span><span class="si">%5d%5d%5d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">count</span> <span class="p">,</span> <span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">ring</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CONECT</span><span class="si">%5d%5d%5d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">count</span> <span class="o">-</span> <span class="n">numdna</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CONECT</span><span class="si">%5d%5d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Connectivity for the dna chain 1 beads</span>
    <span class="k">if</span> <span class="n">ring</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CONECT</span><span class="si">%5d%5d%5d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">count</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">numdna</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CONECT</span><span class="si">%5d%5d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">numdna</span><span class="p">):</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CONECT</span><span class="si">%5d%5d%5d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">count</span> <span class="p">,</span> <span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">ring</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CONECT</span><span class="si">%5d%5d%5d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">count</span> <span class="o">-</span> <span class="n">numdna</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CONECT</span><span class="si">%5d%5d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Connectivity for the dna chain 2 beads</span>
    <span class="k">if</span> <span class="n">ring</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CONECT</span><span class="si">%5d%5d%5d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">count</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">numdna</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CONECT</span><span class="si">%5d%5d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">numdna</span><span class="p">):</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CONECT</span><span class="si">%5d%5d%5d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">count</span> <span class="p">,</span> <span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">ring</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CONECT</span><span class="si">%5d%5d%5d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">count</span> <span class="o">-</span> <span class="n">numdna</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CONECT</span><span class="si">%5d%5d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Connectivity for the nucleosome positions</span>
    <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numnuc</span><span class="p">):</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CONECT</span><span class="si">%5d%5d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CONECT</span><span class="si">%5d%5d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Close the file</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;END&#39;</span><span class="p">)</span>

    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">wlcstat  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">wlcstat.chromo</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Andy Spakowitz.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.2.1.
    </div>
  </body>
</html>